import tensorflow as tf
from keras import layers

# noise input
noise_input = layers.Input(shape = (None, 1000))
noise_branch = layers.Dense(shape = (None, 262144))(noise_input)
noise_branch = layers.Activation('relu')(noise_branch)
noise_branch = layers.Reshape((64, 128, 256))(noise_branch)

# label input
label_input = layers.Input(shape = (None, 1))
label_branch = layers.Embedding()(label_input)
label_branch = layers.Dense(shape = (None, 1, 1000))(label_branch)
label_branch = layers.Reshape((64, 128, 1))(label_branch)

# merged model
merged_input = layers.Concatenate()([noise_branch, label_branch])
merged_branch = layers.Conv2DTranspose(
    256, (5, 5), 
    strides = (2, 2), 
    padding = 'same', 
    input_shape = (64, 128, 257),
    output_shape = (128, 256, 128)
)(merged_input)
merged_branch = layers.BatchNormalization()(merged_branch)
merged_branch = layers.Activation('relu')(merged_branch)
merged_branch = layers.Conv2DTranspose(
    128, (5, 5), 
    strides = (2, 2), 
    padding = 'same', 
    input_shape = (128, 256, 128),
    output_shape = (256, 512, 3)
)(merged_branch)
output = layers.Activation('relu')(merged_branch)

generator = tf.keras.Model(
    inputs = [noise_input, label_input],
    outputs = output
)